name: Protected Paths

on:
  pull_request:

jobs:
  protected_paths:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: read
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Get PR Labels
        id: labels
        uses: actions/github-script@v7
        with:
          script: |
            const pr = context.payload.pull_request;
            if (!pr) return core.setOutput("labels", "");
            const labels = (pr.labels || []).map(l => l.name).join(",");
            core.setOutput("labels", labels);

      - name: Protected paths check
        shell: pwsh
        run: |
          pwsh -NoProfile -File ".github/scripts/protected-paths.ps1" -BaseRef "origin/main" -HeadRef "HEAD" -ConfigPath ".github/protected-paths.json" -AllowFile ".github/ALLOW_PROTECTED_PATHS" -RequireLabel "allow-protected-paths" -PrLabels "${{ steps.labels.outputs.labels }}"
